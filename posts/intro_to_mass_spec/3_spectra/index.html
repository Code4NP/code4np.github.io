<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.533">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chase M Clark">
<meta name="dcterms.date" content="2024-02-03">
<meta name="description" content="An introduction to working with mass spectrometry data in R">

<title>Computational Pharmacognosy - Part 3: Reading mzXML/mzML into R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="../../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Computational Pharmacognosy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../about/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contributors" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contributors</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contributors">    
        <li>
    <a class="dropdown-item" href="../../../contributors/chase/chase.html">
 <span class="dropdown-text">Chase</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contributors/joe/joe.html">
 <span class="dropdown-text">Joe</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Code4NP/code4np.github.io"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Part 3: Reading mzXML/mzML into R</h1>
                  <div>
        <div class="description">
          An introduction to working with mass spectrometry data in R
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">mass spectrometry</div>
                <div class="quarto-category">r</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Roles</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Chase M Clark <a href="https://orcid.org/0000-0001-6439-9397" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
      <p class="affiliation">
          original draft, review &amp; editing 
      </p>
    </div>
    </div>


  <div class="quarto-title-meta">

      
    
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 3, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="5">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a></li>
  <li><a href="#code-basics" id="toc-code-basics" class="nav-link" data-scroll-target="#code-basics">Code (Basics)</a>
  <ul class="collapse">
  <li><a href="#set-up-an-session" id="toc-set-up-an-session" class="nav-link" data-scroll-target="#set-up-an-session">Set Up an 🇷 session</a></li>
  <li><a href="#download-lc-msms-example-data" id="toc-download-lc-msms-example-data" class="nav-link" data-scroll-target="#download-lc-msms-example-data">Download LC-MS/MS example data</a></li>
  <li><a href="#how-to-open-mzxmlmzml-data-in-r" id="toc-how-to-open-mzxmlmzml-data-in-r" class="nav-link" data-scroll-target="#how-to-open-mzxmlmzml-data-in-r">How to open mzXML/mzML data in R</a></li>
  <li><a href="#check-our-assumptions" id="toc-check-our-assumptions" class="nav-link" data-scroll-target="#check-our-assumptions">Check our assumptions</a>
  <ul class="collapse">
  <li><a href="#are-the-number-of-data-points-for-the-ms1-and-ms2-spectra-within-the-range-i-expected-peakscount-column" id="toc-are-the-number-of-data-points-for-the-ms1-and-ms2-spectra-within-the-range-i-expected-peakscount-column" class="nav-link" data-scroll-target="#are-the-number-of-data-points-for-the-ms1-and-ms2-spectra-within-the-range-i-expected-peakscount-column">Are the number of data points for the MS<sup>1</sup> and MS<sup>2</sup> spectra within the range I expected? (<code>peaksCount</code> column)</a></li>
  <li><a href="#is-this-centroid-or-profile-data" id="toc-is-this-centroid-or-profile-data" class="nav-link" data-scroll-target="#is-this-centroid-or-profile-data">Is this centroid or profile data?</a></li>
  <li><a href="#what-max-intensities-can-i-expect" id="toc-what-max-intensities-can-i-expect" class="nav-link" data-scroll-target="#what-max-intensities-can-i-expect">What max intensities can I expect?</a></li>
  <li><a href="#what-are-the-minmax-retention-times" id="toc-what-are-the-minmax-retention-times" class="nav-link" data-scroll-target="#what-are-the-minmax-retention-times">What are the min/max retention times?</a></li>
  <li><a href="#does-the-data-contain-positive-or-negative-mode-spectra-both" id="toc-does-the-data-contain-positive-or-negative-mode-spectra-both" class="nav-link" data-scroll-target="#does-the-data-contain-positive-or-negative-mode-spectra-both">Does the data contain positive or negative mode spectra? Both?</a></li>
  <li><a href="#how-many-ms1-ms2-scans-are-there" id="toc-how-many-ms1-ms2-scans-are-there" class="nav-link" data-scroll-target="#how-many-ms1-ms2-scans-are-there">How many MS<sup>1</sup> MS<sup>2</sup> scans are there?</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#next" id="toc-next" class="nav-link" data-scroll-target="#next">Next</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>This is a continuation from <a href="../2_mzml/" target="_blank">Part 2</a>.</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this post we will go through some simple analysis of LC-MS/MS data as that is one of the more common methods used in our field and the concepts are largely transferable to other types of MS data.</p>
<p>The point of this post is less about teaching R or certain packages (we may do deep-dives using other languages and packages in the future) and more about exposing readers to concepts and how to think about the underlying data.</p>
</section>
<section id="the-data" class="level1">
<h1>The Data</h1>
<p>We will use some data I acquired previously to make things easier… on me.</p>
<p>It’s from an LC-MS/MS run of a <a href="https://www.ncbi.nlm.nih.gov/nuccore/1172004435" target="_blank">single <em>Micromonospora</em></a> extract, in a <a href="https://doi.org/10.1073/pnas.1801247115" target="_blank">previously published study</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Experimental info">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Experimental info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The sample is a <em>Micromonospora</em> extract. The extraction was performed from a bacterial culture growing on solid A1 agar media following the protocol of Bligh,E. G. and Dyer, W. J. (9). Agar cultures were divided into 1 cm<sup>3</sup> pieces and 3 mm glass beads were added. Extraction solvent was added in three steps with vigorous vortexing between steps 1) 1:2 (v/v) CHCl3:MeOH, 2) CHCl3 in 1/3 the added volume of step one, 3) H2O in 1/3 the added volume of step one. From the resulting two-layer liquid partition, the organic layer was retained for further analysis.</p>
<p>The extract was analyzed via LC-MS/MS with a method adapted from that described by <a href="https://doi.org/10.1021/acscentsci.5b00331" target="_blank">Goering et al</a>. Experiments were performed on an Agilent 1200 workstation connected to a Thermo Fisher Scientific Q-Exactive mass spectrometer with an electrospray ionization source. Reversed-phase chromatography was performed by injection of 20 μL of 0.1 mg/mL of extract at a 0.3 mL/min flow rate across a Phenomenex Kinetex C18 RPLC column (150 mm x 2.1 mm i.d., 2 μm particle size). Mobile phase A was water with 0.1% formic acid and mobile phase B was acetonitrile with 0.1% formic acid. Mobile phase B was held at 15% for 1 minute, then adjusted to 95% over 12 minutes, where it was held for 2 minutes, and the system re-equilibrated for 5 minutes. The mass spectrometry parameters were as follows: scan range 200-2000 m/z, resolution 35,000, scan rate ~3.7 per second. Data were gathered in profile and the top 5 most intense peaks in each full spectrum were targeted for fragmentation that employed a collision energy setting of 25 eV for Higher-energy Collisional Dissociation (HCD) and isolation window of 2.0 <em>m/z</em>.</p>
<p>The mzXML file was created with ProteoWizard’s msconvert, using default settings.</p>
</div>
</div>
</div>
</section>
<section id="code-basics" class="level1">
<h1>Code (Basics)</h1>
<section id="set-up-an-session" class="level2">
<h2 class="anchored" data-anchor-id="set-up-an-session">Set Up an 🇷 session</h2>
<p>The rest of this tutorial will take place <a href="https://bookdown.org/introrbook/intro2r/installing-r-and-rstudio.html#installing-rstudio" target="_blank">using R</a>.</p>
<p>Here we will install and then load <a href="https://bioconductor.org/packages/release/bioc/html/mzR.html" target="_blank">mzR</a>, a Bioconductor package for parsing mass spectrometry data. Vignette <a href="https://bioconductor.org/packages/release/bioc/vignettes/mzR/inst/doc/mzR.html" target="_blank">here</a>. For plotting we’ll be using ggplot2 and plotly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"mzR"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">"mzR"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mzR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-lc-msms-example-data" class="level2">
<h2 class="anchored" data-anchor-id="download-lc-msms-example-data">Download LC-MS/MS example data</h2>
<p>Next let’s download the LC-MS/MS data we will be working with to a temporary directory (i.e.&nbsp;the directory will be deleted upon closing the R session).</p>
<p>There are two files:</p>
<ul>
<li>an mzXML file which contains <strong>centroid</strong> data (peaks only)</li>
<li>an mzML file which contains <strong>profile</strong> data (raw data,not peak-picked)</li>
</ul>
<p><a href="https://gnps.ucsd.edu/ProteoSAFe/static/gnps-splash.jsp" target="_blank">GNPS</a> used to require mzXML so that’s the reason for both mzXML and mzML formats.</p>
<p>Warning: This is a 22 MB and 306 MB download.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I have slow internet so I'll increase the amount of time the download is allowed to take</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout=</span><span class="dv">240</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>temporary_directory <span class="ot">&lt;-</span> <span class="fu">tempdir</span>()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 22.3 MB</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#peaks_file_path &lt;- file.path(temporary_directory, "B022.mzXML" )</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#download.file(url = "ftp://massive.ucsd.edu/v01/MSV000081555/peak/B022.mzXML",</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#              destfile = peaks_file_path)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#              </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>peaks_file_path <span class="ot">&lt;-</span> <span class="st">"/home/chase/Downloads/biggy/B022.mzXML"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 306.1 MB</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># raw_mzml_path &lt;- file.path(temporary_directory, "B022.mzML" )</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># download.file(url = "ftp://massive.ucsd.edu/v01/MSV000081555/raw/FullSpectra-mzML/B022_GenbankAccession-KY858245.mzML",</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#               destfile = raw_mzml_path)</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>raw_mzml_path <span class="ot">&lt;-</span> <span class="st">"/home/chase/Downloads/biggy/B022.mzML"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-to-open-mzxmlmzml-data-in-r" class="level2">
<h2 class="anchored" data-anchor-id="how-to-open-mzxmlmzml-data-in-r">How to open mzXML/mzML data in R</h2>
<p>If we look at the first ten lines of:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>peaks_file_path</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/home/chase/Downloads/biggy/B022.mzXML"</code></pre>
</div>
</div>
<p>We can see it is indeed an mzXML file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(peaks_file_path, <span class="at">n=</span><span class="dv">10</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;mzXML xmlns="http://sashimi.sourceforge.net/schema_revision/mzXML_3.2"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://sashimi.sourceforge.net/schema_revision/mzXML_3.2 http://sashimi.sourceforge.net/schema_revision/mzXML_3.2/mzXML_idx_3.2.xsd"&gt;
  &lt;msRun scanCount="4399" startTime="PT0.0673789S" endTime="PT1200.11S"&gt;
    &lt;parentFile fileName="file:///C:\Users\chase\Downloads\LCMSNORTHWESTERN\Example\Input_Folder/20170719_mwm1013_metabologenomics_actinolunaC182x100_B022.raw"
                fileType="RAWData"
                fileSha1="b739a75b1c680e889940f7b35fe9ef07ee5bcd62"/&gt;
    &lt;msInstrument msInstrumentID="1"&gt;
      &lt;msManufacturer category="msManufacturer" value="Thermo Scientific"/&gt;</code></pre>
</div>
</div>
<p>I’m a fan of mzR due to its speed (under the hood is a lot of fast C++ code), and that it lazily loads the data from mzXML/mzML files (it doesn’t read everything into memory unless you request it).</p>
<p>Here we will tell mzR to lazily open the mass spec file we just downloaded. We can see it returns a handle to the file, which contains 4399 “scans”. A scan being a mass spectrum.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>msfile_handle <span class="ot">&lt;-</span> mzR<span class="sc">::</span><span class="fu">openMSfile</span>(peaks_file_path)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>msfile_handle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mass Spectrometry file handle.
Filename:  B022.mzXML 
Number of scans:  4399 </code></pre>
</div>
</div>
<p>mzR uses <a href="https://adv-r.hadley.nz/s3.html" target="_blank">S3</a> object oriented programming which is difficult if you are only used to R’s usual functional programming style. You don’t have to worry much about it because most of what I’ll show is functional, but if you do care there are a number of object based methods you can use.</p>
<p>We can see how mzR “opened/parsed” the file, here using C++ code from ProteoWizard.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>msfile_handle<span class="sc">@</span>backend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C++ object &lt;0x55b6cebbf700&gt; of class 'Pwiz' &lt;0x55b6ceced4e0&gt;</code></pre>
</div>
</div>
<p>One of the most useful {mzR} functions is <code>header()</code> which provides summarizing information about each scan in the dataset. Each scan is numbered sequentially (seqNum/acquisitionNum).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>summary_data <span class="ot">&lt;-</span> <span class="fu">header</span>(msfile_handle)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(summary_data, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["seqNum"],"name":[1],"type":["int"],"align":["right"]},{"label":["acquisitionNum"],"name":[2],"type":["int"],"align":["right"]},{"label":["msLevel"],"name":[3],"type":["int"],"align":["right"]},{"label":["polarity"],"name":[4],"type":["int"],"align":["right"]},{"label":["peaksCount"],"name":[5],"type":["int"],"align":["right"]},{"label":["totIonCurrent"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["retentionTime"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["basePeakMZ"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["basePeakIntensity"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["collisionEnergy"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["ionisationEnergy"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["lowMZ"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["highMZ"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["precursorScanNum"],"name":[14],"type":["int"],"align":["right"]},{"label":["precursorMZ"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["precursorCharge"],"name":[16],"type":["int"],"align":["right"]},{"label":["precursorIntensity"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["mergedScan"],"name":[18],"type":["int"],"align":["right"]},{"label":["mergedResultScanNum"],"name":[19],"type":["int"],"align":["right"]},{"label":["mergedResultStartScanNum"],"name":[20],"type":["int"],"align":["right"]},{"label":["mergedResultEndScanNum"],"name":[21],"type":["int"],"align":["right"]},{"label":["injectionTime"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["filterString"],"name":[23],"type":["chr"],"align":["left"]},{"label":["spectrumId"],"name":[24],"type":["chr"],"align":["left"]},{"label":["centroided"],"name":[25],"type":["lgl"],"align":["right"]},{"label":["ionMobilityDriftTime"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["isolationWindowTargetMZ"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["isolationWindowLowerOffset"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["isolationWindowUpperOffset"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["scanWindowLowerLimit"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["scanWindowUpperLimit"],"name":[31],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"1","4":"1","5":"320","6":"7179157","7":"0.0673789","8":"217.1074","9":"266403.1","10":"NA","11":"0","12":"150.0266","13":"1892.051","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=1","25":"TRUE","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","_rn_":"1"},{"1":"2","2":"2","3":"1","4":"1","5":"673","6":"6511908","7":"0.4336310","8":"301.1406","9":"245597.2","10":"NA","11":"0","12":"150.0265","13":"1980.235","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=2","25":"TRUE","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","_rn_":"2"},{"1":"3","2":"3","3":"1","4":"1","5":"617","6":"7172014","7":"0.7546260","8":"217.1071","9":"208030.5","10":"NA","11":"0","12":"150.0265","13":"1954.778","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=3","25":"TRUE","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","_rn_":"3"},{"1":"4","2":"4","3":"1","4":"1","5":"652","6":"8089850","7":"1.0220100","8":"301.1406","9":"245887.3","10":"NA","11":"0","12":"150.0265","13":"1958.846","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=4","25":"TRUE","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","_rn_":"4"},{"1":"5","2":"5","3":"1","4":"1","5":"565","6":"7538651","7":"1.2895000","8":"301.1407","9":"266377.8","10":"NA","11":"0","12":"150.0265","13":"1985.422","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=5","25":"TRUE","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>THis allows us to do things like filtering for only positive mode MS<sup>2</sup> scans.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> summary_data[summary_data<span class="sc">$</span>polarity <span class="sc">==</span> <span class="dv">1</span>, ][summary_data<span class="sc">$</span>msLevel <span class="sc">==</span> <span class="dv">2</span>, ]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(filtered_df, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["seqNum"],"name":[1],"type":["int"],"align":["right"]},{"label":["acquisitionNum"],"name":[2],"type":["int"],"align":["right"]},{"label":["msLevel"],"name":[3],"type":["int"],"align":["right"]},{"label":["polarity"],"name":[4],"type":["int"],"align":["right"]},{"label":["peaksCount"],"name":[5],"type":["int"],"align":["right"]},{"label":["totIonCurrent"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["retentionTime"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["basePeakMZ"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["basePeakIntensity"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["collisionEnergy"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["ionisationEnergy"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["lowMZ"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["highMZ"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["precursorScanNum"],"name":[14],"type":["int"],"align":["right"]},{"label":["precursorMZ"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["precursorCharge"],"name":[16],"type":["int"],"align":["right"]},{"label":["precursorIntensity"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["mergedScan"],"name":[18],"type":["int"],"align":["right"]},{"label":["mergedResultScanNum"],"name":[19],"type":["int"],"align":["right"]},{"label":["mergedResultStartScanNum"],"name":[20],"type":["int"],"align":["right"]},{"label":["mergedResultEndScanNum"],"name":[21],"type":["int"],"align":["right"]},{"label":["injectionTime"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["filterString"],"name":[23],"type":["chr"],"align":["left"]},{"label":["spectrumId"],"name":[24],"type":["chr"],"align":["left"]},{"label":["centroided"],"name":[25],"type":["lgl"],"align":["right"]},{"label":["ionMobilityDriftTime"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["isolationWindowTargetMZ"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["isolationWindowLowerOffset"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["isolationWindowUpperOffset"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["scanWindowLowerLimit"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["scanWindowUpperLimit"],"name":[31],"type":["dbl"],"align":["right"]}],"data":[{"1":"8","2":"8","3":"2","4":"1","5":"49","6":"96117.32","7":"2.14157","8":"301.14122","9":"48492.03","10":"25","11":"0","12":"50.16715","13":"319.0712","14":"7","15":"301.1405","16":"1","17":"411267.5","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=8","25":"TRUE","26":"NA","27":"NA","28":"1","29":"1","30":"NA","31":"NA","_rn_":"8"},{"1":"29","2":"29","3":"2","4":"1","5":"65","6":"287236.06","7":"7.81044","8":"217.10517","9":"163613.17","10":"25","11":"0","12":"50.93454","13":"218.1087","14":"28","15":"217.1069","16":"1","17":"238682.0","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=29","25":"TRUE","26":"NA","27":"NA","28":"1","29":"1","30":"NA","31":"NA","_rn_":"29"},{"1":"41","2":"41","3":"2","4":"1","5":"100","6":"1545867.50","7":"11.12990","8":"113.96369","9":"626562.44","10":"25","11":"0","12":"50.89707","13":"156.1382","14":"40","15":"154.9900","16":"0","17":"89905.9","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=41","25":"TRUE","26":"NA","27":"NA","28":"1","29":"1","30":"NA","31":"NA","_rn_":"41"},{"1":"81","2":"81","3":"2","4":"1","5":"104","6":"475490.09","7":"21.90190","8":"84.95964","9":"102565.70","10":"25","11":"0","12":"51.17863","13":"168.1384","14":"80","15":"167.0125","16":"1","17":"263485.1","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=81","25":"TRUE","26":"NA","27":"NA","28":"1","29":"1","30":"NA","31":"NA","_rn_":"81"},{"1":"84","2":"84","3":"2","4":"1","5":"55","6":"95975.35","7":"22.66680","8":"301.14101","9":"39457.93","10":"25","11":"0","12":"51.32985","13":"322.4011","14":"83","15":"301.1404","16":"1","17":"142265.4","18":"NA","19":"NA","20":"NA","21":"NA","22":"0","23":"NA","24":"controllerType=0 controllerNumber=1 scan=84","25":"TRUE","26":"NA","27":"NA","28":"1","29":"1","30":"NA","31":"NA","_rn_":"84"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>The other useful function I’ll bring up in this post retrieves the actual mass spectra. If just provided the file handle it will load every scan in the file as a separate two-column matrix. For each matrix the first column represents m/z and the second column is intensity. If a scan number is provided it will return the two-column matrix for that specific scan.</p>
<p>Let’s look at the first five lines of the fourth scan/mass spectrum.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note: mzR::peaks() and mzR::spectra() are interchangeable</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>single_spectrum <span class="ot">&lt;-</span> mzR<span class="sc">::</span><span class="fu">peaks</span>(msfile_handle, <span class="at">scans=</span><span class="dv">4</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(single_spectrum, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]      [,2]
[1,] 150.0265 32913.336
[2,] 151.0238  2110.815
[3,] 151.0272  3636.793
[4,] 152.0564  4872.385
[5,] 153.0907  2387.040</code></pre>
</div>
</div>
</section>
<section id="check-our-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="check-our-assumptions">Check our assumptions</h2>
<p>Whenever you get new data the first thing you should do is get a feel for the data and confirm any assumptions that could influence your analysis. Some, but not all of the ways you can do so are shown here.</p>
<p>We can use <code>mzR::openMSfile()</code> to open the file in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>full_spectra_handle <span class="ot">&lt;-</span> mzR<span class="sc">::</span><span class="fu">openMSfile</span>(raw_mzml_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the <code>header()</code> function we can peak at the first 10 rows of the summary information about each spectrum in the file. This is not reading any spectra data yet but pulling metadata about each spectrum that is stored within the mzML file, as described in <a href="../2_mzml/#where-are-the-spectra" target="_blank">post 2</a>. We can see there is both MS<sup>1</sup> and MS<sup>2</sup> spectra i this file.</p>
<section id="are-the-number-of-data-points-for-the-ms1-and-ms2-spectra-within-the-range-i-expected-peakscount-column" class="level3">
<h3 class="anchored" data-anchor-id="are-the-number-of-data-points-for-the-ms1-and-ms2-spectra-within-the-range-i-expected-peakscount-column">Are the number of data points for the MS<sup>1</sup> and MS<sup>2</sup> spectra within the range I expected? (<code>peaksCount</code> column)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>header_table <span class="ot">&lt;-</span> <span class="fu">header</span>(full_spectra_handle)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(header_table, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["seqNum"],"name":[1],"type":["int"],"align":["right"]},{"label":["acquisitionNum"],"name":[2],"type":["int"],"align":["right"]},{"label":["msLevel"],"name":[3],"type":["int"],"align":["right"]},{"label":["polarity"],"name":[4],"type":["int"],"align":["right"]},{"label":["peaksCount"],"name":[5],"type":["int"],"align":["right"]},{"label":["totIonCurrent"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["retentionTime"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["basePeakMZ"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["basePeakIntensity"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["collisionEnergy"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["ionisationEnergy"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["lowMZ"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["highMZ"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["precursorScanNum"],"name":[14],"type":["int"],"align":["right"]},{"label":["precursorMZ"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["precursorCharge"],"name":[16],"type":["int"],"align":["right"]},{"label":["precursorIntensity"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["mergedScan"],"name":[18],"type":["int"],"align":["right"]},{"label":["mergedResultScanNum"],"name":[19],"type":["int"],"align":["right"]},{"label":["mergedResultStartScanNum"],"name":[20],"type":["int"],"align":["right"]},{"label":["mergedResultEndScanNum"],"name":[21],"type":["int"],"align":["right"]},{"label":["injectionTime"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["filterString"],"name":[23],"type":["chr"],"align":["left"]},{"label":["spectrumId"],"name":[24],"type":["chr"],"align":["left"]},{"label":["centroided"],"name":[25],"type":["lgl"],"align":["right"]},{"label":["ionMobilityDriftTime"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["isolationWindowTargetMZ"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["isolationWindowLowerOffset"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["isolationWindowUpperOffset"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["scanWindowLowerLimit"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["scanWindowUpperLimit"],"name":[31],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"1","3":"1","4":"1","5":"4583","6":"7179157.00","7":"0.06737892","8":"217.1074","9":"266403.12","10":"NA","11":"0","12":"148.50836","13":"2020.2154","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"8.032729","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=1","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"1"},{"1":"2","2":"2","3":"1","4":"1","5":"9624","6":"6511907.50","7":"0.43363087","8":"301.1406","9":"245597.16","10":"NA","11":"0","12":"148.50823","13":"2020.2110","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"24.682077","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=2","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"2"},{"1":"3","2":"3","3":"1","4":"1","5":"8913","6":"7172014.00","7":"0.75462594","8":"217.1071","9":"208030.50","10":"NA","11":"0","12":"148.50825","13":"2020.2113","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"21.071672","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=3","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"3"},{"1":"4","2":"4","3":"1","4":"1","5":"9435","6":"8089849.50","7":"1.02201000","8":"301.1406","9":"245887.30","10":"NA","11":"0","12":"148.50822","13":"2020.2108","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"21.007834","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=4","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"4"},{"1":"5","2":"5","3":"1","4":"1","5":"8082","6":"7538651.00","7":"1.28950302","8":"301.1407","9":"266377.75","10":"NA","11":"0","12":"148.50825","13":"2020.2119","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"17.063016","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=5","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"5"},{"1":"6","2":"6","3":"1","4":"1","5":"10672","6":"10536195.00","7":"1.55687802","8":"301.1405","9":"344449.06","10":"NA","11":"0","12":"148.50818","13":"2020.2103","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"17.587380","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=6","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"6"},{"1":"7","2":"7","3":"1","4":"1","5":"8816","6":"11714992.00","7":"1.82425992","8":"301.1408","9":"411267.47","10":"NA","11":"0","12":"148.50814","13":"2020.2112","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"13.089477","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=7","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"7"},{"1":"8","2":"8","3":"2","4":"1","5":"709","6":"96117.32","7":"2.14157292","8":"301.1412","9":"48492.03","10":"25","11":"0","12":"49.50231","13":"328.2829","14":"7","15":"301.1405","16":"1","17":"411267.5","18":"NA","19":"NA","20":"NA","21":"NA","22":"250.000000","23":"FTMS + p ESI d Full ms2 301.14@hcd25.00 [50.00-325.00]","24":"controllerType=0 controllerNumber=1 scan=8","25":"FALSE","26":"NA","27":"301.1405","28":"1","29":"1","30":"50","31":"325","_rn_":"8"},{"1":"9","2":"9","3":"1","4":"1","5":"6252","6":"7221482.50","7":"2.27901000","8":"301.1407","9":"341709.91","10":"NA","11":"0","12":"148.50839","13":"2020.2146","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"11.786613","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=9","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"9"},{"1":"10","2":"10","3":"1","4":"1","5":"11621","6":"11140158.00","7":"2.63150184","8":"301.1404","9":"326700.69","10":"NA","11":"0","12":"148.50810","13":"2020.2109","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"19.311955","23":"FTMS + p ESI Full ms [150.00-2000.00]","24":"controllerType=0 controllerNumber=1 scan=10","25":"FALSE","26":"NA","27":"NA","28":"NA","29":"NA","30":"150","31":"2000","_rn_":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="is-this-centroid-or-profile-data" class="level3">
<h3 class="anchored" data-anchor-id="is-this-centroid-or-profile-data">Is this centroid or profile data?</h3>
<p>All the values in <code>header_table$centroided</code> are false so all the scans in the file are profile. This aligns with the large numbers seen in the <code>peaksCount</code> column above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(header_table<span class="sc">$</span>centroided)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE 
 4399 </code></pre>
</div>
</div>
</section>
<section id="what-max-intensities-can-i-expect" class="level3">
<h3 class="anchored" data-anchor-id="what-max-intensities-can-i-expect">What max intensities can I expect?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(header_table<span class="sc">$</span>totIonCurrent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
    12168   1841128  10199948  14827967  19327535 341675010 </code></pre>
</div>
</div>
</section>
<section id="what-are-the-minmax-retention-times" class="level3">
<h3 class="anchored" data-anchor-id="what-are-the-minmax-retention-times">What are the min/max retention times?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Minimum retention time: "</span>, <span class="fu">min</span>(header_table<span class="sc">$</span>retentionTime), <span class="st">" s"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Minimum retention time: 0.06737892 s"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"Maximum retention time: "</span>, <span class="fu">max</span>(header_table<span class="sc">$</span>retentionTime) , <span class="st">" s"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Maximum retention time: 1200.10806 s"</code></pre>
</div>
</div>
</section>
<section id="does-the-data-contain-positive-or-negative-mode-spectra-both" class="level3">
<h3 class="anchored" data-anchor-id="does-the-data-contain-positive-or-negative-mode-spectra-both">Does the data contain positive or negative mode spectra? Both?</h3>
<p>Here it’s positive because the only value within the <code>polarity</code> column is <code>1</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(header_table<span class="sc">$</span>polarity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   1 
4399 </code></pre>
</div>
</div>
</section>
<section id="how-many-ms1-ms2-scans-are-there" class="level3">
<h3 class="anchored" data-anchor-id="how-many-ms1-ms2-scans-are-there">How many MS<sup>1</sup> MS<sup>2</sup> scans are there?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(header_table<span class="sc">$</span>msLevel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   1    2 
3283 1116 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It should be noted that the <code>peaksCount</code> column has the same name whether you have loaded centroid or profile data and is best thought of as the number of data points within a single scan/spectrum.</p>
</div>
</div>
</section>
</section>
</section>
<section id="next" class="level1">
<h1>Next</h1>
<p>In the <a href="../4_reanalysis/" target="_blank">next post</a> we will do some introduction to analysis and plotting using the same data as in this post.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="quarto-dev/quarto-docs" data-repo-id="" data-category="General" data-category-id="" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->




</body></html>