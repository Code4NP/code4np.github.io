Work in progress...

Currently we are working out how everything works. Contributions are currently invite-only.

# Intro

The blog is powered by Quarto.

- Each post gets its own directory in `posts`.
- Post series get a top directory in `posts` then a directory for each post. e.g. `posts/mass-spec/post-1`, `posts/mass-spec/post-2`

# Setup

Clone the blog repo

```sh
git clone https://github.com/Code4NP/code4np.github.io.git
cd code4np.github.io
git checkout main
git checkout -b my-post-name
git push -u origin my-post-name
```

Write your post and push the changes to this branch

e.g.

```sh
git add .
git commit -m "message"
git pull
git push
```

# Writing

## The Quarto YAML header block

Whether you are writing a post in a Quarto or Jupyter notebook, your post must have a Quarto YAML metadata header at the top of the file (In a markdown cell, if Jupyter)

A minimal example:

```quarto
---
title: "Introduction to reproducible computing: Docker"
author:
  - name: Chase M Clark
    orcid: 0000-0001-6439-9397
    roles:  
      - writing – original draft
      - writing – review & editing
date: "2024-01-02"
description: "Introduction to reproducible computing; Docker"
---
```

Make sure to at least include the fields shown in the minimal example. Additional options can be found here: https://quarto.org/docs/reference/formats/html.html

## Creating a post

Copy the `posts/template_post` directory and rename it to #TODO

Edit the YAML header block and then add your content to the `index.qmd` file. If you are writing using a Jupyter notebook-- you must name the file `index.ipynb`, copy the YAML header block from `index.qmd` and insert it as a markdown cell at the very top of your notebook, edit the header block as needed.

## Categories

Relevant categories should be added to posts. You can do this by adding the `categories` field to the YAML header of a post.

e.g.:

```qmd
---
title: "Visualize a MALDI spectrum in base R"
author: "Chase M. Clark"
categories: [example, mass spectrometry]
---
```

Only use (or add to) categories listed in `code4np.github.io/.github/taglist.txt`.

## Dependencies

We are testing out using [pixi](https://pixi.sh/) but this may change back to micromamba if needed. Pixi is fast, provides more features than conda/mamba, and produces cross-os dependency lockfiles so, in theory, should make installing and reproducing posts easier for everyone. But it's unclear what the company's business model will be.

Each post directory will contain a pixi.toml and pixi.lock file. pixi.toml is where dependencies to run the .qmd/.ipynb notebook are specified by the post writer and the pixi.lock file is auto-generated by pixi.

You can edit the toml file manually or ia pixi.


To [install pixi](https://pixi.sh/#installation): `curl -fsSL https://pixi.sh/install.sh | bash`

Then to e.g. add Python and R as a dependency in the template post:

```sh
cd posts/template_post
pixi add r-base==4.1.3 python==3.12.1
```

The main source of dependencies is Conda, you can search for dependcies using e.g. `pixi search python`

For PyPI and other sources see https://pixi.sh/configuration/#the-system-requirements-table


[PypI](https://pixi.sh/configuration/#pypi-dependencies-beta-feature) dependencies
Pixi can install Conda packages and PyPI packages with wheels. The not-released, but in main branch, version can install PyPI packages that don't have uploaded wheels.

For now if you need to a install a Python package that doesn't install you can use a task like shown in the template_post which would have to be run via `pixi install && pixi run  install_python_package_from_git`

Each post directory also contains a Dockerfile, unless really needed you should avoid modifying this. It is there in case there's really something that can't be specified via pixi.

The blog will be rendered via the Dockerfile and pixi.toml. The Quarto version used for the blog is specified in `site_utils/Dockerfile`

## Rendering a post with Quarto

Make sure you have Make installed

To render a post the blog's Makefile contains a pseudo-target `render`.

For example, to render the example post in directory `posts/example_post_1_qmd-just_text` you would navigate your terminal to the top directory of the blog (contains the `Makefile` file) and run:

```sh
make render posts/example_post_1_qmd-just_text/index.qmd
```

# Previewing the blog

The entire blog can be previewed via the make command:

```sh
make preview
```
