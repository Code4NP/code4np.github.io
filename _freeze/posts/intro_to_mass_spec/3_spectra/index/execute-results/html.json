{
  "hash": "4c12696b4c6d77e5c85b22bacac45283",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Part 3: Reading mzXML/mzML into R\"\nauthor:\n  - name: Chase M Clark\n    orcid: 0000-0001-6439-9397\n    roles: [original draft, review & editing]\ncategories: [beginner, mass spectrometry, r]\ndate: \"2024-02-03\"\ndescription: \"An introduction to working with mass spectrometry data in R\"\nexecute: \n  cache: true\n  freeze: true\nformat:\n  html:\n    df-print: paged\nfilters:\n  - collapse-callout\ncollapse-callout:\n  all: true  \n---\n\n\nThis is a continuation from [Part 2](../2_mzml/).\n\n# Introduction\n\nIn this post we will go through some simple analysis of LC-MS/MS data as that is one of the more common methods used in our field and the concepts are largely transferable to other types of MS data. \n\nThe point of this post is less about teaching R or certain packages (we may do deep-dives using other languages and packages in the future) and more about exposing readers to concepts and how to think about the underlying data.\n\n\n# The Data\n\nWe will use some data I acquired previously to make things easier... on me. \n\nIt's from an LC-MS/MS run of a [single *Micromonospora*](https://www.ncbi.nlm.nih.gov/nuccore/1172004435) extract, in a [previously published study](https://doi.org/10.1073/pnas.1801247115).\n\n::: {.callout-tip title=\"Experimental info\" collapse=true}\nThe sample is a *Micromonospora* extract. The extraction was performed from a bacterial culture growing on solid A1 agar media following the protocol of Bligh,E. G. and Dyer, W. J. (9). Agar cultures were divided into 1 cm^3^ pieces and 3 mm glass beads\nwere added. Extraction solvent was added in three steps with vigorous vortexing between steps 1) 1:2 (v/v) CHCl3:MeOH, 2) CHCl3 in 1/3 the added volume of step one, 3) H2O in 1/3 the added volume of step one. From the resulting two-layer liquid partition, the organic layer was retained for further analysis.\n\nThe extract was analyzed via LC-MS/MS with a method adapted from that described by [Goering et al](https://doi.org/10.1021/acscentsci.5b00331). Experiments were performed on an Agilent 1200 workstation connected to a Thermo Fisher Scientific Q-Exactive mass spectrometer with an electrospray ionization source. Reversed-phase chromatography was performed by injection of 20 Î¼L of 0.1 mg/mL of extract at a 0.3 mL/min flow rate across a Phenomenex Kinetex C18 RPLC column (150 mm x 2.1 mm i.d., 2 Î¼m particle size). Mobile phase A was water with 0.1% formic acid and mobile phase B was acetonitrile with 0.1% formic acid. Mobile phase B was held at 15% for 1 minute, then adjusted to 95% over 12 minutes, where it was held for 2 minutes, and the system re-equilibrated for 5 minutes. The mass spectrometry parameters were as follows: scan range 200-2000 m/z, resolution 35,000, scan rate ~3.7 per second. Data were gathered in profile and the top 5 most intense peaks in each full spectrum were targeted for fragmentation that employed a collision energy setting of 25 eV for Higher-energy Collisional Dissociation (HCD) and isolation window of 2.0 *m/z*.\n\nThe mzXML file was created with ProteoWizard's msconvert, using default settings.\n:::\n\n# Code (Basics)\n\n## Set Up an ðŸ‡· session\n\nThe rest of this tutorial will take place [using R](https://bookdown.org/introrbook/intro2r/installing-r-and-rstudio.html#installing-rstudio). \n\nHere we will install and then load [mzR](https://bioconductor.org/packages/release/bioc/html/mzR.html), a Bioconductor package for parsing mass spectrometry data. Vignette [here](https://bioconductor.org/packages/release/bioc/vignettes/mzR/inst/doc/mzR.html). For plotting we'll be using ggplot2 and plotly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"mzR\", quietly = TRUE)){\n  if (!require(\"BiocManager\", quietly = TRUE)){\n      install.packages(\"BiocManager\")\n  }\n  BiocManager::install(\"mzR\")\n}\n  \nlibrary(mzR)\n```\n:::\n\n\n## Download LC-MS/MS example data\n\nNext let's download the LC-MS/MS data we will be working with to a temporary directory (i.e. the directory will be deleted upon closing the R session). \n\nThere are two files: \n\n- an mzXML file which contains **centroid** data (peaks only)\n- an mzML file which contains **profile** data (raw data,not peak-picked)\n\n[GNPS](https://gnps.ucsd.edu/ProteoSAFe/static/gnps-splash.jsp) used to require mzXML so that's the reason for both mzXML and mzML formats.\n\n\nWarning: This is a 22 MB and 306 MB download.\n\n::: {.cell}\n\n```{.r .cell-code}\n# I have slow internet so I'll increase the amount of time the download is allowed to take\noptions(timeout=240)\n\ntemporary_directory <- tempdir()\n\n# 22.3 MB\npeaks_file_path <- file.path(temporary_directory, \"B022.mzXML\" )\ndownload.file(url = \"ftp://massive.ucsd.edu/v01/MSV000081555/peak/B022.mzXML\",\n             destfile = peaks_file_path)\n             \n# 306.1 MB\nraw_mzml_path <- file.path(temporary_directory, \"B022.mzML\" )\ndownload.file(url = \"ftp://massive.ucsd.edu/v01/MSV000081555/raw/FullSpectra-mzML/B022_GenbankAccession-KY858245.mzML\",\n              destfile = raw_mzml_path)\n```\n:::\n\n\n\n## How to open mzXML/mzML data in R\n\nIf we look at the first ten lines of:\n\n::: {.cell}\n\n```{.r .cell-code}\npeaks_file_path\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/tmp/RtmpHtTeyr/B022.mzXML\"\n```\n\n\n:::\n:::\n\n\nWe can see it is indeed an mzXML file:\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(readLines(peaks_file_path, n=10), sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<mzXML xmlns=\"http://sashimi.sourceforge.net/schema_revision/mzXML_3.2\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xsi:schemaLocation=\"http://sashimi.sourceforge.net/schema_revision/mzXML_3.2 http://sashimi.sourceforge.net/schema_revision/mzXML_3.2/mzXML_idx_3.2.xsd\">\n  <msRun scanCount=\"4399\" startTime=\"PT0.0673789S\" endTime=\"PT1200.11S\">\n    <parentFile fileName=\"file:///C:\\Users\\chase\\Downloads\\LCMSNORTHWESTERN\\Example\\Input_Folder/20170719_mwm1013_metabologenomics_actinolunaC182x100_B022.raw\"\n                fileType=\"RAWData\"\n                fileSha1=\"b739a75b1c680e889940f7b35fe9ef07ee5bcd62\"/>\n    <msInstrument msInstrumentID=\"1\">\n      <msManufacturer category=\"msManufacturer\" value=\"Thermo Scientific\"/>\n```\n\n\n:::\n:::\n\n\nI'm a fan of mzR due to its speed (under the hood is a lot of fast C++ code), and that it lazily loads the data from mzXML/mzML files (it doesn't read everything into memory unless you request it).\n\nHere we will tell mzR to lazily open the mass spec file we just downloaded. We can see it returns a handle to the file, which contains 4399 \"scans\". A scan being a mass spectrum. \n\n::: {.cell}\n\n```{.r .cell-code}\nmsfile_handle <- mzR::openMSfile(peaks_file_path)\nmsfile_handle\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMass Spectrometry file handle.\nFilename:  B022.mzXML \nNumber of scans:  4399 \n```\n\n\n:::\n:::\n\n\n\nmzR uses [S3](https://adv-r.hadley.nz/s3.html) object oriented programming which is difficult if you are only used to R's usual functional programming style. You don't have to worry much about it because most of what I'll show is functional, but if you do care there are a number of object based methods you can use.\n\nWe can see how mzR \"opened/parsed\" the file, here using C++ code from ProteoWizard.\n\n::: {.cell}\n\n```{.r .cell-code}\nmsfile_handle@backend\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nC++ object <0x5624ada3aa70> of class 'Pwiz' <0x5624aecbea90>\n```\n\n\n:::\n:::\n\n\nOne of the most useful {mzR} functions is `header()` which provides summarizing information about each scan in the dataset. Each scan is numbered sequentially (seqNum/acquisitionNum).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary_data <- header(msfile_handle)\nhead(summary_data, 5)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"seqNum\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"acquisitionNum\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"msLevel\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"polarity\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"peaksCount\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"totIonCurrent\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"retentionTime\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"basePeakMZ\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"basePeakIntensity\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"collisionEnergy\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ionisationEnergy\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lowMZ\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"highMZ\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"precursorScanNum\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"precursorMZ\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"precursorCharge\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"precursorIntensity\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mergedScan\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultScanNum\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultStartScanNum\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultEndScanNum\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"injectionTime\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"filterString\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"spectrumId\"],\"name\":[24],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"centroided\"],\"name\":[25],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"ionMobilityDriftTime\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowTargetMZ\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowLowerOffset\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowUpperOffset\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"scanWindowLowerLimit\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"scanWindowUpperLimit\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1\",\"3\":\"1\",\"4\":\"1\",\"5\":\"320\",\"6\":\"7179157\",\"7\":\"0.0673789\",\"8\":\"217.1074\",\"9\":\"266403.1\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"150.0266\",\"13\":\"1892.051\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=1\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150.0266\",\"31\":\"1892.051\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"2\",\"3\":\"1\",\"4\":\"1\",\"5\":\"673\",\"6\":\"6511908\",\"7\":\"0.4336310\",\"8\":\"301.1406\",\"9\":\"245597.2\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"150.0265\",\"13\":\"1980.235\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=2\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150.0265\",\"31\":\"1980.235\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"3\",\"3\":\"1\",\"4\":\"1\",\"5\":\"617\",\"6\":\"7172014\",\"7\":\"0.7546260\",\"8\":\"217.1071\",\"9\":\"208030.5\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"150.0265\",\"13\":\"1954.778\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=3\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150.0265\",\"31\":\"1954.778\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"4\",\"3\":\"1\",\"4\":\"1\",\"5\":\"652\",\"6\":\"8089850\",\"7\":\"1.0220100\",\"8\":\"301.1406\",\"9\":\"245887.3\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"150.0265\",\"13\":\"1958.846\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=4\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150.0265\",\"31\":\"1958.846\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"5\",\"3\":\"1\",\"4\":\"1\",\"5\":\"565\",\"6\":\"7538651\",\"7\":\"1.2895000\",\"8\":\"301.1407\",\"9\":\"266377.8\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"150.0265\",\"13\":\"1985.422\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=5\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150.0265\",\"31\":\"1985.422\",\"_rn_\":\"5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nTHis allows us to do things like filtering for only positive mode MS^2^ scans.\n\n::: {.cell}\n\n```{.r .cell-code}\nfiltered_df <- summary_data[summary_data$polarity == 1, ][summary_data$msLevel == 2, ]\nhead(filtered_df, 5)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"seqNum\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"acquisitionNum\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"msLevel\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"polarity\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"peaksCount\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"totIonCurrent\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"retentionTime\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"basePeakMZ\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"basePeakIntensity\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"collisionEnergy\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ionisationEnergy\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lowMZ\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"highMZ\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"precursorScanNum\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"precursorMZ\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"precursorCharge\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"precursorIntensity\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mergedScan\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultScanNum\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultStartScanNum\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultEndScanNum\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"injectionTime\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"filterString\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"spectrumId\"],\"name\":[24],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"centroided\"],\"name\":[25],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"ionMobilityDriftTime\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowTargetMZ\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowLowerOffset\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowUpperOffset\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"scanWindowLowerLimit\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"scanWindowUpperLimit\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"8\",\"2\":\"8\",\"3\":\"2\",\"4\":\"1\",\"5\":\"49\",\"6\":\"96117.32\",\"7\":\"2.14157\",\"8\":\"301.14122\",\"9\":\"48492.03\",\"10\":\"25\",\"11\":\"0\",\"12\":\"50.16715\",\"13\":\"319.0712\",\"14\":\"7\",\"15\":\"301.1405\",\"16\":\"1\",\"17\":\"411267.5\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=8\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"1\",\"29\":\"1\",\"30\":\"50.16715\",\"31\":\"319.0712\",\"_rn_\":\"8\"},{\"1\":\"29\",\"2\":\"29\",\"3\":\"2\",\"4\":\"1\",\"5\":\"65\",\"6\":\"287236.06\",\"7\":\"7.81044\",\"8\":\"217.10517\",\"9\":\"163613.17\",\"10\":\"25\",\"11\":\"0\",\"12\":\"50.93454\",\"13\":\"218.1087\",\"14\":\"28\",\"15\":\"217.1069\",\"16\":\"1\",\"17\":\"238682.0\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=29\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"1\",\"29\":\"1\",\"30\":\"50.93454\",\"31\":\"218.1087\",\"_rn_\":\"29\"},{\"1\":\"41\",\"2\":\"41\",\"3\":\"2\",\"4\":\"1\",\"5\":\"100\",\"6\":\"1545867.50\",\"7\":\"11.12990\",\"8\":\"113.96369\",\"9\":\"626562.44\",\"10\":\"25\",\"11\":\"0\",\"12\":\"50.89707\",\"13\":\"156.1382\",\"14\":\"40\",\"15\":\"154.9900\",\"16\":\"0\",\"17\":\"89905.9\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=41\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"1\",\"29\":\"1\",\"30\":\"50.89707\",\"31\":\"156.1382\",\"_rn_\":\"41\"},{\"1\":\"81\",\"2\":\"81\",\"3\":\"2\",\"4\":\"1\",\"5\":\"104\",\"6\":\"475490.09\",\"7\":\"21.90190\",\"8\":\"84.95964\",\"9\":\"102565.70\",\"10\":\"25\",\"11\":\"0\",\"12\":\"51.17863\",\"13\":\"168.1384\",\"14\":\"80\",\"15\":\"167.0125\",\"16\":\"1\",\"17\":\"263485.1\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=81\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"1\",\"29\":\"1\",\"30\":\"51.17863\",\"31\":\"168.1384\",\"_rn_\":\"81\"},{\"1\":\"84\",\"2\":\"84\",\"3\":\"2\",\"4\":\"1\",\"5\":\"55\",\"6\":\"95975.35\",\"7\":\"22.66680\",\"8\":\"301.14101\",\"9\":\"39457.93\",\"10\":\"25\",\"11\":\"0\",\"12\":\"51.32985\",\"13\":\"322.4011\",\"14\":\"83\",\"15\":\"301.1404\",\"16\":\"1\",\"17\":\"142265.4\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"0\",\"23\":\"NA\",\"24\":\"controllerType=0 controllerNumber=1 scan=84\",\"25\":\"TRUE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"1\",\"29\":\"1\",\"30\":\"51.32985\",\"31\":\"322.4011\",\"_rn_\":\"84\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nThe other useful function I'll bring up in this post retrieves the actual mass spectra. If just provided the file handle it will load every scan in the file as a separate two-column matrix. For each matrix the first column represents m/z and the second column is intensity. If a scan number is provided it will return the two-column matrix for that specific scan.\n\nLet's look at the first five lines of the fourth scan/mass spectrum.\n\n::: {.cell}\n\n```{.r .cell-code}\n# note: mzR::peaks() and mzR::spectra() are interchangeable\nsingle_spectrum <- mzR::peaks(msfile_handle, scans=4)\nhead(single_spectrum, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           mz intensity\n[1,] 150.0265 32913.336\n[2,] 151.0238  2110.815\n[3,] 151.0272  3636.793\n[4,] 152.0564  4872.385\n[5,] 153.0907  2387.040\n```\n\n\n:::\n:::\n\n\n\n\n## Check our assumptions\n\nWhenever you get new data the first thing you should do is get a feel for the data and confirm any assumptions that could influence your analysis. Some, but not all of the ways you can do so are shown here.\n\nWe can use `mzR::openMSfile()` to open the file in R.\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_spectra_handle <- mzR::openMSfile(raw_mzml_path)\n```\n:::\n\n\n\nUsing the `header()` function we can peak at the first 10 rows of the summary information about each spectrum in the file. This is not reading any spectra data yet but pulling metadata about each spectrum that is stored within the mzML file, as described in [post 2](../2_mzml/#where-are-the-spectra).\nWe can see there is both MS^1^ and MS^2^ spectra i this file.\n\n### Are the number of data points for the MS^1^ and MS^2^ spectra within the range I expected? (`peaksCount` column)\n\n::: {.cell}\n\n```{.r .cell-code}\nheader_table <- header(full_spectra_handle)\nhead(header_table, 10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"seqNum\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"acquisitionNum\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"msLevel\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"polarity\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"peaksCount\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"totIonCurrent\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"retentionTime\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"basePeakMZ\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"basePeakIntensity\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"collisionEnergy\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ionisationEnergy\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lowMZ\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"highMZ\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"precursorScanNum\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"precursorMZ\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"precursorCharge\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"precursorIntensity\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mergedScan\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultScanNum\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultStartScanNum\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"mergedResultEndScanNum\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"injectionTime\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"filterString\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"spectrumId\"],\"name\":[24],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"centroided\"],\"name\":[25],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"ionMobilityDriftTime\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowTargetMZ\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowLowerOffset\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"isolationWindowUpperOffset\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"scanWindowLowerLimit\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"scanWindowUpperLimit\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"1\",\"3\":\"1\",\"4\":\"1\",\"5\":\"4583\",\"6\":\"7179157.00\",\"7\":\"0.06737892\",\"8\":\"217.1074\",\"9\":\"266403.12\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50836\",\"13\":\"2020.2154\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"8.032729\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=1\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"1\"},{\"1\":\"2\",\"2\":\"2\",\"3\":\"1\",\"4\":\"1\",\"5\":\"9624\",\"6\":\"6511907.50\",\"7\":\"0.43363087\",\"8\":\"301.1406\",\"9\":\"245597.16\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50823\",\"13\":\"2020.2110\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"24.682077\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=2\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"2\"},{\"1\":\"3\",\"2\":\"3\",\"3\":\"1\",\"4\":\"1\",\"5\":\"8913\",\"6\":\"7172014.00\",\"7\":\"0.75462594\",\"8\":\"217.1071\",\"9\":\"208030.50\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50825\",\"13\":\"2020.2113\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"21.071672\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=3\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"3\"},{\"1\":\"4\",\"2\":\"4\",\"3\":\"1\",\"4\":\"1\",\"5\":\"9435\",\"6\":\"8089849.50\",\"7\":\"1.02201000\",\"8\":\"301.1406\",\"9\":\"245887.30\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50822\",\"13\":\"2020.2108\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"21.007834\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=4\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"4\"},{\"1\":\"5\",\"2\":\"5\",\"3\":\"1\",\"4\":\"1\",\"5\":\"8082\",\"6\":\"7538651.00\",\"7\":\"1.28950302\",\"8\":\"301.1407\",\"9\":\"266377.75\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50825\",\"13\":\"2020.2119\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"17.063016\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=5\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"5\"},{\"1\":\"6\",\"2\":\"6\",\"3\":\"1\",\"4\":\"1\",\"5\":\"10672\",\"6\":\"10536195.00\",\"7\":\"1.55687802\",\"8\":\"301.1405\",\"9\":\"344449.06\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50818\",\"13\":\"2020.2103\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"17.587380\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=6\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"6\"},{\"1\":\"7\",\"2\":\"7\",\"3\":\"1\",\"4\":\"1\",\"5\":\"8816\",\"6\":\"11714992.00\",\"7\":\"1.82425992\",\"8\":\"301.1408\",\"9\":\"411267.47\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50814\",\"13\":\"2020.2112\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"13.089477\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=7\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"7\"},{\"1\":\"8\",\"2\":\"8\",\"3\":\"2\",\"4\":\"1\",\"5\":\"709\",\"6\":\"96117.32\",\"7\":\"2.14157292\",\"8\":\"301.1412\",\"9\":\"48492.03\",\"10\":\"25\",\"11\":\"0\",\"12\":\"49.50231\",\"13\":\"328.2829\",\"14\":\"7\",\"15\":\"301.1405\",\"16\":\"1\",\"17\":\"411267.5\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"250.000000\",\"23\":\"FTMS + p ESI d Full ms2 301.14@hcd25.00 [50.00-325.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=8\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"301.1405\",\"28\":\"1\",\"29\":\"1\",\"30\":\"50\",\"31\":\"325\",\"_rn_\":\"8\"},{\"1\":\"9\",\"2\":\"9\",\"3\":\"1\",\"4\":\"1\",\"5\":\"6252\",\"6\":\"7221482.50\",\"7\":\"2.27901000\",\"8\":\"301.1407\",\"9\":\"341709.91\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50839\",\"13\":\"2020.2146\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"11.786613\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=9\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"9\"},{\"1\":\"10\",\"2\":\"10\",\"3\":\"1\",\"4\":\"1\",\"5\":\"11621\",\"6\":\"11140158.00\",\"7\":\"2.63150184\",\"8\":\"301.1404\",\"9\":\"326700.69\",\"10\":\"NA\",\"11\":\"0\",\"12\":\"148.50810\",\"13\":\"2020.2109\",\"14\":\"NA\",\"15\":\"NA\",\"16\":\"NA\",\"17\":\"NA\",\"18\":\"NA\",\"19\":\"NA\",\"20\":\"NA\",\"21\":\"NA\",\"22\":\"19.311955\",\"23\":\"FTMS + p ESI Full ms [150.00-2000.00]\",\"24\":\"controllerType=0 controllerNumber=1 scan=10\",\"25\":\"FALSE\",\"26\":\"NA\",\"27\":\"NA\",\"28\":\"NA\",\"29\":\"NA\",\"30\":\"150\",\"31\":\"2000\",\"_rn_\":\"10\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n### Is this centroid or profile data?\nAll the values in `header_table$centroided` are false so all the scans in the file are profile. This aligns with the large numbers seen in the `peaksCount` column above.\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(header_table$centroided)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFALSE \n 4399 \n```\n\n\n:::\n:::\n\n\n\n### What max intensities can I expect?\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(header_table$totIonCurrent)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. \n    12168   1841128  10199948  14827967  19327535 341675010 \n```\n\n\n:::\n:::\n\n\n\n### What are the min/max retention times?\n\n::: {.cell}\n\n```{.r .cell-code}\npaste0(\"Minimum retention time: \", min(header_table$retentionTime), \" s\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Minimum retention time: 0.06737892 s\"\n```\n\n\n:::\n\n```{.r .cell-code}\npaste0(\"Maximum retention time: \", max(header_table$retentionTime) , \" s\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Maximum retention time: 1200.10806 s\"\n```\n\n\n:::\n:::\n\n\n### Does the data contain positive or negative mode spectra? Both?\n\nHere it's positive because the only value within the `polarity` column is `1`\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(header_table$polarity)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   1 \n4399 \n```\n\n\n:::\n:::\n\n\n### How many MS^1^ MS^2^ scans are there?\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(header_table$msLevel)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   1    2 \n3283 1116 \n```\n\n\n:::\n:::\n\n\n\n::: {.callout-note} \nIt should be noted that the `peaksCount` column has the same name whether you have loaded centroid or profile data and is best thought of as the number of data points within a single scan/spectrum.\n:::\n\n\n# Next\n\nIn the [next post](../4_reanalysis/) we will do some introduction to analysis and plotting using the same data as in this post.\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}